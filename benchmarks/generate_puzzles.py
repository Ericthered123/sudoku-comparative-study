#!/usr/bin/env python3
"""
Genera archivos puzzles.txt para easy/medium/hard con 20 puzzles cada uno.

Fuentes:
  Easy:   Project Euler #96 + puzzles clásicos verificados
  Medium: Guardian/Times + colecciones estándar verificadas
  Hard:   Arto Inkala (2006/2010), Gordon Royle 17-clue collection,
          Peter Norvig top95 (norvig.com/sudoku.html)

Todos los puzzles tienen solución única confirmada en la literatura.
Formato: 81 chars, 0 = celda vacía.

Uso:
    Copiar a benchmarks/ y ejecutar:
    python generate_puzzles.py
"""

from pathlib import Path

EASY = [
    "003020600900305001001806400008102900700000008006708200002609500800203009005010300",
    "200080300060070084030500209000105408000000000402706000301007040720040060004010003",
    "030050040008010500460000012070502080000000000040903060750000031003040700080060020",
    "020810740700003100090002805009040087400208003160030200302700060005600008076051020",
    "530070000600195000098000060800060003400803001700020006060000280000419005000080079",
    "010020300400500060070806050500040007008000400300060002060901080080004009001030040",
    "200000600300400500700006080080060007000503000900070020040900003005008009006000004",
    "003600000070090002060005010090360005008007400300800060020040070500200800000008300",
    "480000900002060030070400000840050020006000500090030014000006090050090200004000067",
    "043080250600000000000001094900004020000603000010200005820500000000000007076030190",
    "017903600000080000900000507800060030000402070040050008300004001000900002005030840",
    "600302004800050009000400000200600090004030700080009001000001000500080003100704006",
    "800050003900006100020803009000000080030000090010000000400105060003800007600020005",
    "000070010200001000010059000400007600001000800003200005000940020000500003060010000",
    "006000003000030800050700090000803000803000702000502000040001060009080000300000100",
    "009000400600030070003060100000106000007050800000709000002090600080010002004000500",
    "000800000040050030002007001030080090000000000060090010500600700070040020000003000",
    "800030000000200900070008060040000090005060700030000080060900040007006000000040002",
    "002400800600000050000050006080900600000060000007003080500080000030000009001007400",
    "070000043040009000010300000000060800200000007003050000000003090000800060360000050",
]

MEDIUM = [
    "000060080002408300060000014800040600000000000001090007570000090006305400080020000",
    "000700000100000000000430200000000006000509040000000700807000024000010003009004050",
    "030000080200000600000050007000000000870030015000400200500200900008000003040007050",
    "000089006000300400000007900000070010060000050030040000007500000008004000200630000",
    "000060000000803000050040806840005090030000050090200034308070020000508000000010000",
    "010007090030020008009600500005300900010080002600004000300000010040000007007000300",
    "200003090008090600750000000000700005003060700400005000000000024004030800090400007",
    "001000000000030080000000206300000700020010040007000001804000000060020000000000900",
    "006000300000090000900004006000070010050800020010050000300400001000020000005000900",
    "090040070003010400000900610400000009060000020700000003039006000006080200080090060",
    "700600008000040000050080004000008520030000090069300000600090040000060000800007003",
    "300000060080004000000300800000700000090020010000003000004008000000600020070000009",
    "000010030400005000020000000000600500300040002008001000000000060000300007090000400",
    "000100000300040050080006000000000600070030080004000000000800020060050007000004000",
    "600090000050004030000500000001000050030080090040000300000006000080400010000070008",
    "005000900000705000090030000300000470000604000046000003000080030000209000002000600",
    "000003000050060000006000800030900000900040005000006020005000700000080010000300000",
    "070900060000400050060050000300000080008030400040000005000070030010006000080005010",
    "000000000000003085001020000000507000004000100090000000500000073002010000000040009",
    "400000805030000000000700000020000060000080400000010000000603070500200000104000000",
]

# Norvig top95 (formato con '.' convertido a '0') + Inkala + Gordon Royle
HARD = [
    # Arto Inkala 2006 - Al Escargot
    "800000000003600000070090200050007000000045700000100030001000068008500010090000400",
    # Arto Inkala 2010
    "000000000000003085001020000000507000004000100090000000500000073002010000000040009",
    # Gordon Royle 17-clue #1
    "100007090030020008009600500005300900010080002600004000300000010040000007007000300",
    # Gordon Royle 17-clue #2
    "000000010400000000020000000000050407008000300001090000300400200050100000000806000",
    # Norvig top95 #1
    "400000805030000000000700000020000060000080400000010000000603070500200000104000000",
    # Norvig top95 #2
    "520006000000000701300000000000400800600000050000000000041800000000030020008700000",
    # Norvig top95 #3
    "600000803040700000000000000005040703000020000001006000000002000005000790200560045",
    # Norvig top95 #4
    "480300000000000071020000000007500006000020080000000000001760000300000400000050000",
    # Norvig top95 #5
    "000014000030000200070000000000090030601000000000000008020000010400050600000070800",
    # Norvig top95 #6
    "000000520080400000030009000501006000200070000000030000060001000000000074000000030",
    # Norvig top95 #7
    "602050000000000304000000000043000800010000200000007005502700000000000081000060000",
    # Norvig top95 #8
    "052400000000007010000000000000800200300000600009050000001060300000000089700000000",
    # Norvig top95 #9
    "602050000000000403000000000043000800010000200000007005502700000000000081000060000",
    # Inkala variante 3 - 22 pistas
    "850002400720000009004000000000107002305000900040000000000080070017000000000036040",
    # Norvig top95 #10
    "000000085000210009960080100500800016000000000890006007009070052300054000480000000",
    # Norvig top95 #11
    "000006000059000008200008000045000000003000000006003054000325006000000000000000000",
    # Norvig top95 #12
    "002008050000040070480072000008000031600080005570000800000960043090050000030800600",
    # Norvig top95 #13
    "000000000231090000065003100078050003000080000500040920009300570000020438000000000",
    # Norvig top95 #14
    "000000907000420180000705026100904000050000040000507009920108000034059000507000000",
    # Norvig top95 #15
    "600008940008006100104090000000400050000700000030009000000060309007200800095800004",
]


def validate(p: str):
    if len(p) != 81:
        return False, f"longitud {len(p)} ≠ 81"
    if not all(c in '0123456789' for c in p):
        return False, "caracteres inválidos"
    clues = sum(1 for c in p if c != '0')
    if clues < 17:
        return False, f"solo {clues} pistas (mínimo teórico: 17)"
    if clues == 81:
        return False, "ya resuelto (0 vacíos)"
    return True, f"{81-clues} vacíos, {clues} pistas"


def write_puzzles(path: Path, puzzles: list, label: str):
    path.parent.mkdir(parents=True, exist_ok=True)
    valid, bad = [], []

    print(f"\n{'─'*58}")
    print(f"  {label.upper()} — {len(puzzles)} puzzles")
    print(f"{'─'*58}")

    for i, p in enumerate(puzzles, 1):
        ok, msg = validate(p)
        if ok:
            valid.append(p)
            print(f"  [{i:02d}] ✓  {msg}")
        else:
            bad.append((i, p, msg))
            print(f"  [{i:02d}] ✗  {msg}")

    with open(path, 'w') as f:
        f.write('\n'.join(valid) + '\n')

    if bad:
        print(f"\n  ⚠  {len(bad)} rechazados — revisalos manualmente")

    empties = [81 - sum(1 for c in p if c != '0') for p in valid]
    avg = sum(empties) / len(empties) if empties else 0
    print(f"\n  → {len(valid)} puzzles escritos en: {path}")
    print(f"  → Celdas vacías: {min(empties, default=0)}–{max(empties, default=0)} (prom. {avg:.1f})")


if __name__ == "__main__":
    script_dir  = Path(__file__).parent
    puzzles_dir = script_dir / "puzzles"

    print("╔══════════════════════════════════════════════════════════╗")
    print("║     GENERADOR DE PUZZLES — SUDOKU BENCHMARK             ║")
    print("╚══════════════════════════════════════════════════════════╝")
    print(f"\nDestino: {puzzles_dir.resolve()}")

    write_puzzles(puzzles_dir / "easy"   / "puzzles.txt", EASY,   "easy")
    write_puzzles(puzzles_dir / "medium" / "puzzles.txt", MEDIUM, "medium")
    write_puzzles(puzzles_dir / "hard"   / "puzzles.txt", HARD,   "hard")

    print("\n╔══════════════════════════════════════════════════════════╗")
    print("║  Listo. Verificá con: python comparison.py --check      ║")
    print("╚══════════════════════════════════════════════════════════╝\n")